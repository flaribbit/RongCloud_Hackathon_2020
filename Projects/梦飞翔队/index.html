<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="http://cdn.ronghub.com/RongIMLib-3.0.5-dev.js"></script>
    <title>Document</title>
</head>

<body>
    <h2>测试</h2>
    <script>
        var user = {
            token: ''
        };
        var im = RongIMLib.init({ appkey: '' }); // 初始化 IM 实例(单个页面仅需初始化一次)
        im.connect(user).then(function (user) {
            console.log('链接成功, 链接用户 id 为: ', user.id);
            var chatRoom = im.ChatRoom.get({
                id: 'danmaku'
            });
            chatRoom.join({
                count: 20 // 进入后, 自动拉取 20 条聊天室最新消息
            }).then(function () {
                console.log('加入聊天室成功');
                chatRoom.send({
                    messageType: 'RC:TxtMsg',
                    content: {
                        content: 'Hello RongCloud' // 文本内容
                    }
                }).then(function (message) {
                    console.log('发送文字消息成功', message);
                });
            }).catch(function (error) {
                console.log(error);
            });
        }).catch(function (error) {
            console.log('链接失败: ', error.code, error.msg);
        });

        var conversationList = []; // 当前已存在的会话列表
        im.watch({
            conversation: function (event) {
                var updatedConversationList = event.updatedConversationList; // 更新的会话列表
                console.log('更新会话汇总:', updatedConversationList);
                console.log('最新会话列表:', im.Conversation.merge({
                    conversationList,
                    updatedConversationList
                }));
            },
            message: function (event) {
                var message = event.message;
                console.log('收到新消息:', message);
            },
            status: function (event) {
                var status = event.status;
                console.log('连接状态码:', status);
            }
        });
    </script>
</body>

</html>